<!DOCTYPE html>
<html lang="it">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analizzatore Armonico</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            background-color: #0a0a0a;
            color: #e0e0e0;
        }

        /* Piano Styles */
        .white-key {
            background: linear-gradient(to bottom, #ffffff 0%, #e6e6e6 100%);
            position: relative;
            z-index: 1;
        }

        .white-key.active {
            background: #3b82f6 !important;
            box-shadow: inset 0 -3px 0 rgba(0, 0, 0, 0.2);
        }

        .black-key {
            background: linear-gradient(to bottom, #333 0%, #000 100%);
            box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.6);
            z-index: 10;
        }

        .black-key.active {
            background: #60a5fa !important;
            border: 1px solid #3b82f6;
        }

        /* Nodes & Panels */
        .flow-node {
            background: #161616;
            border: 1px solid #262626;
            transition: all 0.2s ease;
        }

        .flow-node.active {
            border-color: #3b82f6;
            background: rgba(30, 58, 138, 0.15);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .ext-tag {
            background: #1e3a8a;
            border: 1px solid #1d4ed8;
            color: #bfdbfe;
            font-size: 0.8rem;
            padding: 4px 10px;
            border-radius: 6px;
            font-weight: 600;
        }

        .omit-tag {
            background: #451a1a;
            border: 1px solid #7f1d1d;
            color: #fecaca;
            font-size: 0.8rem;
            padding: 4px 10px;
            border-radius: 6px;
            font-weight: 600;
        }

        /* Buttons */
        .btn-action {
            transition: all 0.2s;
        }

        .btn-action:active {
            transform: scale(0.95);
        }

        /* Card Styles - Made more compact */
        .card-node {
            background: #121212;
            border: 1px solid #333;
            border-radius: 16px;
            padding: 12px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            transition: all 0.3s ease;
            min-height: 90px;
            position: relative;
        }

        /* Desktop Overrides */
        @media (min-width: 768px) {
            .card-node {
                flex-direction: row;
                justify-content: space-between;
                text-align: left;
                min-height: 70px;
            }
        }

        /* Neon Themes */
        :root {
            --col-root: #81c784;
            --col-third: #64b5f6;
            --col-fifth: #e57373;
            --col-seventh: #ffd54f;
            --col-ext: #ba68c8;
        }

        .theme-root.active {
            border-color: var(--col-root);
            box-shadow: 0 0 15px rgba(129, 199, 132, 0.2);
        }

        .theme-root .label {
            color: var(--col-root);
        }

        .theme-root .value {
            color: #fff;
        }

        .theme-third.active {
            border-color: var(--col-third);
            box-shadow: 0 0 15px rgba(100, 181, 246, 0.2);
        }

        .theme-third .label {
            color: var(--col-third);
        }

        .theme-third .value {
            color: #fff;
        }

        .theme-fifth.active {
            border-color: var(--col-fifth);
            box-shadow: 0 0 15px rgba(229, 115, 115, 0.2);
        }

        .theme-fifth .label {
            color: var(--col-fifth);
        }

        .theme-fifth .value {
            color: #fff;
        }

        .theme-seventh.active {
            border-color: var(--col-seventh);
            box-shadow: 0 0 15px rgba(255, 213, 79, 0.2);
        }

        .theme-seventh .label {
            color: var(--col-seventh);
        }

        .theme-seventh .value {
            color: #fff;
        }

        .theme-ext.active {
            border-color: var(--col-ext);
            box-shadow: 0 0 15px rgba(186, 104, 200, 0.2);
        }

        .theme-ext .label {
            color: var(--col-ext);
        }

        .theme-ext .value {
            color: #fff;
        }

        /* Active Key Colors */
        .key-root {
            background: var(--col-root) !important;
            box-shadow: 0 0 15px var(--col-root) !important;
            border: none !important;
        }

        .key-third {
            background: var(--col-third) !important;
            box-shadow: 0 0 15px var(--col-third) !important;
            border: none !important;
        }

        .key-fifth {
            background: var(--col-fifth) !important;
            box-shadow: 0 0 15px var(--col-fifth) !important;
            border: none !important;
        }

        .key-seventh {
            background: var(--col-seventh) !important;
            box-shadow: 0 0 15px var(--col-seventh) !important;
            border: none !important;
        }

        .key-ext {
            background: var(--col-ext) !important;
            box-shadow: 0 0 15px var(--col-ext) !important;
            border: none !important;
        }

        /* Scrollbar */
        .hide-scroll::-webkit-scrollbar {
            display: none;
        }
    </style>
</head>

<body class="min-h-screen flex flex-col items-center p-2 md:p-4 bg-[#0a0a0a] text-[#e0e0e0]">

    <!-- Main Container -->
    <main class="w-full max-w-7xl p-2 md:p-4 lg:p-6 grid grid-cols-1 lg:grid-cols-12 gap-3 md:gap-6 lg:gap-8">

        <!-- Left Column: Analysis (5 cols) -->
        <div class="lg:col-span-5 flex flex-col gap-3 md:gap-6">
            <!-- Header -->
            <div class="flex justify-between items-center px-2">
                <div class="flex items-center gap-4">
                    <div class="text-gray-500 text-sm font-medium tracking-widest uppercase">Analizzatore Armonico</div>
                </div>
                <div class="text-gray-600">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd"
                            d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z"
                            clip-rule="evenodd" />
                    </svg>
                </div>
            </div>

            <!-- Chord Display - Made larger -->
            <div class="text-center lg:text-left py-2 md:py-4">
                <h2 id="chordNameDisplay"
                    class="text-5xl md:text-6xl lg:text-7xl font-bold text-white tracking-tight drop-shadow-2xl mb-2">--
                </h2>
                <div id="chordOptionsContainer"
                    class="flex flex-wrap justify-center lg:justify-start gap-2 mb-4 min-h-[2rem]"></div>
                <div id="chordDetail" class="text-xl text-gray-500 font-light"></div>
                <div id="intervalList" class="hidden">--</div>
            </div>

            <!-- Analysis Grid -->
            <div class="grid grid-cols-2 gap-3">

                <!-- 1. Root (Green) -->
                <div id="node-root" class="card-node theme-root">
                    <div class="flex md:flex-row flex-col items-center gap-2 md:gap-3">
                        <div class="text-2xl opacity-80">Ⅰ</div>
                        <div class="label text-[10px] font-bold uppercase tracking-widest">1. Fondamentale</div>
                    </div>
                    <div class="value text-2xl font-bold" id="text-root">--</div>
                </div>

                <!-- 2. Quality (Blue) -->
                <div id="node-char" class="card-node theme-third">
                    <div class="flex md:flex-row flex-col items-center gap-2 md:gap-3">
                        <div class="text-2xl opacity-80">Ⅲ</div>
                        <div class="label text-[10px] font-bold uppercase tracking-widest">2. Qualità</div>
                    </div>
                    <div class="value text-xl font-bold leading-tight" id="text-char">--</div>
                </div>

                <!-- 3. Stability (Reddish) -->
                <div id="node-stab" class="card-node theme-fifth">
                    <div class="flex md:flex-row flex-col items-center gap-2 md:gap-3">
                        <div class="text-2xl opacity-80">Ⅴ</div>
                        <div class="label text-[10px] font-bold uppercase tracking-widest">3. Stabilità</div>
                    </div>
                    <div class="value text-xl font-bold leading-tight" id="text-stab">--</div>
                </div>

                <!-- 4. Function (Yellow) -->
                <div id="node-func" class="card-node theme-seventh">
                    <div class="flex md:flex-row flex-col items-center gap-2 md:gap-3">
                        <div class="text-2xl opacity-80">Ⅶ</div>
                        <div class="label text-[10px] font-bold uppercase tracking-widest">4. Funzione</div>
                    </div>
                    <div class="value text-xl font-bold leading-tight" id="text-func">--</div>
                </div>
            </div>

            <!-- Extensions (Purple) - Fixed centering -->
            <div id="node-ext" class="card-node theme-ext">
                <div class="w-full">
                    <div class="label text-[10px] font-bold uppercase tracking-widest mb-1 text-center md:text-left">
                        Estensioni</div>
                    <div id="container-extensions" class="value text-2xl font-bold text-center md:text-left">--</div>
                </div>
            </div>

            <!-- Hidden container for omissions (to prevent JS errors) -->
            <div id="container-omits" class="hidden">--</div>

        </div>

        <!-- Right Column: Keyboard & Controls (7 cols) -->
        <div
            class="lg:col-span-7 flex flex-col justify-center items-center min-h-[200px] lg:min-h-[500px] bg-[#111] rounded-3xl border border-[#222] p-2 lg:p-8 relative overflow-hidden">

            <!-- Background Decoration -->
            <div class="absolute inset-0 bg-gradient-to-br from-blue-900/10 to-purple-900/10 pointer-events-none"></div>

            <!-- Controls Header -->
            <div class="flex justify-between items-center w-full max-w-[600px] mb-2 lg:mb-4 relative z-10">
                <div class="text-xs text-gray-500 font-bold uppercase tracking-widest">
                    Tastiera Interattiva
                </div>
                <div class="flex gap-2 lg:gap-3">
                    <!-- Waveform Toggle -->
                    <button id="btn-waveform"
                        class="h-10 w-10 rounded-full bg-[#161616] text-gray-400 hover:text-white border border-[#333] hover:border-gray-500 flex items-center justify-center transition-colors focus:outline-none shadow-sm"
                        title="Cambia Forma d'Onda">
                        <!-- Icon injected by JS -->
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M2 12h5l3 5 4-10 3 5h5" />
                        </svg>
                    </button>

                    <!-- Play Button -->
                    <button onclick="playCurrentChord()"
                        class="h-10 w-10 rounded-full bg-[#222] text-white hover:bg-[#333] border border-[#333] flex items-center justify-center shadow-sm transition active:scale-95"
                        title="Suona Accordo">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd"
                                d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z"
                                clip-rule="evenodd" />
                        </svg>
                    </button>

                    <!-- Reset Button -->
                    <button onclick="resetPiano()"
                        class="h-10 w-10 rounded-full bg-[#222] text-gray-400 hover:bg-[#333] border border-[#333] flex items-center justify-center shadow-sm transition active:scale-95"
                        title="Resetta">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd"
                                d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v3.276a1 1 0 01-2 0V14.907a7.002 7.002 0 01-11.669-3.676 1 1 0 01.676-1.174z"
                                clip-rule="evenodd" />
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Piano Container -->
            <div
                class="overflow-x-auto hide-scroll pb-1 lg:pb-4 w-full flex justify-start lg:justify-center relative z-10">
                <div class="inline-block min-w-max">
                    <div id="keyboard" class="flex relative select-none h-32 lg:h-48 w-[600px]">
                        <!-- Keys generated via JS -->
                    </div>
                </div>
            </div>

        </div>

    </main>

    <script type="module" src="/src/main.ts"></script>
</body>

</html>
